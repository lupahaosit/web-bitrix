<header-component></header-component>
<div class="task-details-container container mt-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title text-primary mb-4">{{task!.name}}</h3>

            <div class="task-details">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
                        <p class="text-muted">{{task?.description}}</p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-2"><strong>–°—Ç–∞—Ç—É—Å:</strong></p>
                        <p>
                            {{getStatus(task?.status)}}
                        </p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-2"><strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong></p>
                        <p class="text-muted">{{task?.endDate | date:'dd.MM.yyyy'}}</p>
                    </div>
                </div>

                @if (task?.assignedFiles && task.assignedFiles.length > 0) {
                    <div class="assigned-files task-section mb-4">
                        <h5 class="mb-3">üìé –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h5>
                        <div class="list-group">
                            @for (file of task.assignedFiles; track file.id) {
                                <a (click)="downloadFile(file.id)" target="_blank" class="list-group-item list-group-item-action">
                                    <i class="bi bi-file-earmark me-2"></i>{{file.name}}
                                 </a>
                            }
                        </div>
                    </div>
                }


                    <div class="text-answer task-section mb-4">
                        <h5 class="mb-3">üìù –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç:</h5>
                        <textarea
                                name="textAnswer"
                                [(ngModel)]="task.textAnswer"
                                class="form-control"
                                rows="4"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç...">
                        </textarea>
                    </div>



                    <div class="url-answer task-section mb-4">
                        <h5 class="mb-3">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–≤–µ—Ç:</h5>
                        <textarea
                                [(ngModel)]="task.urlAnswer"
                                class="form-control"
                                rows="2"
                                placeholder="https://example.com">
                        </textarea>
                    </div>


                <div class="file-answer task-section mb-4">
                    <h5 class="mb-3">üìÅ –§–∞–π–ª –æ—Ç–≤–µ—Ç–∞:</h5>

                    @if (task?.fileAnswer && task.fileAnswer!!.name) {
                        <div class="existing-file mb-2">
                            <div class="d-flex align-items-center">
                                <span class="me-2">‚úÖ</span>
                                <span>–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:</span>
                                <strong class="ms-2">{{ task.fileAnswer!!.name }}</strong>
                                <span class="text-muted ms-2">({{ task.fileAnswer!!.date | date:'dd.MM.yyyy' }})</span>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-outline-secondary btn-sm me-2"
                                       (click)="downloadFile(task.fileAnswer!!.id)">
                                    –°–∫–∞—á–∞—Ç—å
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm"
                                       (click)="replaceFile()">
                                    –ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª
                                </button>
                            </div>
                        </div>
                    } @else {
                        <div class="file-upload">
                            <input
                                    type="file"
                                    (change)="setFile($event)"
                                    class="form-control">
                            <div class="form-text">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
                        </div>
                    }
                </div>

                @if (task?.review) {
                    <div class="text-answer, task-section mb-4">
                        <h5 class="mb-3">–û—Ç–∑—ã–≤: </h5>
                        <p class="form-control">
                            {{task.review}}
                        </p>
                    </div>
                }

                @if (task?.mark) {
                    <div>
                        <h3 class="mb-3">–û—Ü–µ–Ω–∫–∞: {{task.mark}}</h3>
                    </div>
                }
            </div>

            <div class="d-flex justify-content-end mt-4">
                <button (click)="save()" class="btn btn-primary btn-lg">
                    <i class="bi bi-check-circle me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>
<footer-component></footer-component>